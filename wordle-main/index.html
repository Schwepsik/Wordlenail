<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link href="style.css" rel="stylesheet">
        <title></title>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    </head>
    
    <body>
        <audio id = "idAudio">
            <source src = "music.mp3" type = "audio/ogg" >
            <source src = "music.mp3" type ="audio/mpeg">The browser is not supporting the audio element...
        </audio>
        <button id="playButton" onclick="toggleAudio()">
            <img id="audioImage" src="music_off.png" alt="Paused">
        </button> 
        <div id="background-container">
            <img id="background-image" src="fon.jpg" alt="Background image">
        </div>
        
        <header></header>
        <div class="top-currency"> 
            <img src="coin.png" alt="Валюта" id="currency-image">
            <span id="currency-count">0</span> </div>
        <div class="gif-container" id="character-container">
            <img src="default_character.gif" alt="Персонаж" id="character-image">
        </div>
        <div class="top-left">
                <button onclick="window.location.href='rating.html'">
                <img src="rating.png" alt="Кубок" id="cup-image">
                <span>Рейтинг</span> 
            </button>
        </div>
        
        
        <div class="top-right">
            <button onclick="window.location.href='Shop.html'">
            <img src="shop.png" alt="Магазин" id="shop-image">
            <span>Магазин</span> 
        </button>
    </div>

        <div>
            <table>
                <tr>
                    <td> <input type="text" maxlength="1" ></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                </tr>
                <tr>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                </tr>
                <tr>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                </tr>
                <tr>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                </tr>
                <tr>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                </tr>
                <tr>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                    <td> <input type="text" maxlength="1"></td>
                </tr>
            </table>
        </div>
        <div>
            <p id="total-words-count-label" class="words"></p>
        <div id="modal" class="modal">
            <div class="modal-content">
                <p id="modalMessage"></p>
                <button id="newGameButton">Начать новую игру</button>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="script.js"></script>
        <script>
            var a = document.getElementById("idAudio");
            var image = document.getElementById("audioImage"); 
            var isPlaying = false;
        
            // Устанавливаем начальное изображение
            image.src = "music_on.png"; // Измените на ваше изображение "Пауза"
        
            function toggleAudio() {
                if (isPlaying) {
                    a.pause();
                    isPlaying = false;
                    image.src = "music_on.png"; // Измените на ваше изображение "Пауза"
                } else {
                    a.play();
                    isPlaying = true;
                    image.src = "music_off.png"; // Измените на ваше изображение "Воспроизведение"
                }
            }
        </script>
        <script>
            $(document).ready(() => {
                // Получаем валюту из localStorage
                const currency = parseInt(localStorage.getItem('currency')) || 2000; // Устанавливаем 2000 по умолчанию
                $('#currency-count').text(currency); // Обновляем отображение валюты

                // Получаем ID пользователя из localStorage
                const userId = localStorage.getItem('userId');
                console.log('ID пользователя из localStorage:', userId); // Логируем ID пользователя

                if (userId) {
                    // Запрос на получение скина пользователя
                    $.get('get_user_skin.php', { id: userId })
                        .done(function(data) {
                            try {
                                const response = typeof data === 'string' ? JSON.parse(data) : data;
                                if (response.status === 'success') {
                                    const skinId = response.skin; // Получаем значение skin из ответа
                                    let skinImage = skinId == 0 ? 'default_character.gif' : 'img' + skinId + '.gif'; // Определяем изображение скина

                                    // Обновляем изображение персонажа
                                    $('#character-container img').attr('src', skinImage);
                                    $('.gif-container img').attr('src', skinImage); // Обновляем изображение скина
                                    console.log('Скин установлен:', skinImage); // Логируем установленный скин
                                } else {
                                    console.error('Ошибка при получении скина:', response.message);
                                    setDefaultSkin();
                                }
                            } catch (e) {
                                console.error('Ошибка при обработке ответа:', e);
                                setDefaultSkin();
                            }
                        })
                        .fail(function(jqXHR, textStatus, errorThrown) {
                            console.error('Ошибка при запросе:', textStatus, errorThrown);
                            setDefaultSkin();
                        });
                } else {
                    setDefaultSkin();
                }

                function setDefaultSkin() {
                    $('#character-container img').attr('src', 'default_character.gif');
                    $('.gif-container img').attr('src', 'default_character.gif');
                    console.log('ID пользователя не найден, установлен по умолчанию.'); // Логируем установку по умолчанию
                }
            });

        </script>
        
    </body>
</html>